<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Test-Kernel</title>
<script src="./kernel.js"></script>
<link rel="stylesheet" href="./qunit/qunit-git.css">
<script src="./qunit/qunit-git.js"></script>
<script>
//********************************************************************
//********Test the functions defined in kernel.js.
//********Programmer: Zhao Leiyu, Wang Anqi
//********Date: 2014-9-28
//********************************************************************
	QUnit.test("Test-Arena",function( assert ){//test the object Arena's construct function
		var testArena = new Arena();
		for (var i = GLOBAL_CONST.HEIGHT - 1; i >= 0; i--) {
			for (var j = 0; j < GLOBAL_CONST.WIDTH -1; j++) {//every grid's value of the origin terrain should be 0
				assert.equal(testArena.terrain[i][j],0);
				assert.equal(testArena.changed[i][j],false);
			};
		};
	});

	QUnit.test("Test-NavigateCell", function( assert ){//test function NavigateCell
		//test whether the neighbors fo [2,3] are correct
		assert.deepEqual(NavigateCell([2,3],GLOBAL_CONST.NEIGHBOR[0]),[1,2]);
		assert.deepEqual(NavigateCell([2,3],GLOBAL_CONST.NEIGHBOR[1]),[1,3]);
		assert.deepEqual(NavigateCell([2,3],GLOBAL_CONST.NEIGHBOR[2]),[1,4]);
		assert.deepEqual(NavigateCell([2,3],GLOBAL_CONST.NEIGHBOR[3]),[2,4]);
		assert.deepEqual(NavigateCell([2,3],GLOBAL_CONST.NEIGHBOR[4]),[3,4]);
		assert.deepEqual(NavigateCell([2,3],GLOBAL_CONST.NEIGHBOR[5]),[3,3]);
		assert.deepEqual(NavigateCell([2,3],GLOBAL_CONST.NEIGHBOR[6]),[3,2]);
		assert.deepEqual(NavigateCell([2,3],GLOBAL_CONST.NEIGHBOR[7]),[2,2]);
		//test whether the neighbors fo [0,0] are correct
		assert.deepEqual(NavigateCell([0,0],GLOBAL_CONST.NEIGHBOR[0]),[4,4]);
		assert.deepEqual(NavigateCell([0,0],GLOBAL_CONST.NEIGHBOR[1]),[4,0]);
		assert.deepEqual(NavigateCell([0,0],GLOBAL_CONST.NEIGHBOR[2]),[4,1]);
		assert.deepEqual(NavigateCell([0,0],GLOBAL_CONST.NEIGHBOR[3]),[0,1]);
		assert.deepEqual(NavigateCell([0,0],GLOBAL_CONST.NEIGHBOR[4]),[1,1]);
		assert.deepEqual(NavigateCell([0,0],GLOBAL_CONST.NEIGHBOR[5]),[1,0]);
		assert.deepEqual(NavigateCell([0,0],GLOBAL_CONST.NEIGHBOR[6]),[1,4]);
		assert.deepEqual(NavigateCell([0,0],GLOBAL_CONST.NEIGHBOR[7]),[0,4]);
		//test whether the neighbors fo [3,0] are correct
		assert.deepEqual(NavigateCell([3,0],GLOBAL_CONST.NEIGHBOR[0]),[2,4]);
		assert.deepEqual(NavigateCell([3,0],GLOBAL_CONST.NEIGHBOR[1]),[2,0]);
		assert.deepEqual(NavigateCell([3,0],GLOBAL_CONST.NEIGHBOR[2]),[2,1]);
		assert.deepEqual(NavigateCell([3,0],GLOBAL_CONST.NEIGHBOR[3]),[3,1]);
		assert.deepEqual(NavigateCell([3,0],GLOBAL_CONST.NEIGHBOR[4]),[4,1]);
		assert.deepEqual(NavigateCell([3,0],GLOBAL_CONST.NEIGHBOR[5]),[4,0]);
		assert.deepEqual(NavigateCell([3,0],GLOBAL_CONST.NEIGHBOR[6]),[4,4]);
		assert.deepEqual(NavigateCell([3,0],GLOBAL_CONST.NEIGHBOR[7]),[3,4]);
	});
	
	QUnit.test("Test-RefreshArena",function( assert){//test function RefreshArena
		for(var i = 0; i < 512; i++){// all possible layout in a 3*3 grid
			var testArena = new Arena();
			var tempI = i;
			var count = 0;//count the number of live cells except the center cell
			//generate cells' layout
			for(var j = 1; j <= 3; j++){
				for(var k = 1; k <= 3; k++){
					testArena.terrain[j][k] = tempI % 2;
					tempI = parseInt(tempI/2);
					if(j != 2 || k != 2){//live cells except the center cell
						count+=testArena.terrain[j][k];
					}
					else{//center cell
						var origincell = testArena.terrain[j][k];
					}
				};
			};
			//test whether the next generation's layout is correct
			var nextArena = RefreshArena(testArena);
			var expected,changed_expect;
			switch(count){
				case 2:
					expected = testArena.terrain[2][2];
					changed_expect = false;
					break;

				//spawn a living cell here
				case 3:
					expected = 1;
					if(origincell){
						changed_expect = false;
					}
					else{
						changed_expect = true;
					}
					break;
				//kill the cell
				default:
					expected = 0;
					if(origincell){
						changed_expect = true;
					}
					else{
						changed_expect = false;
					}
			}
			assert.equal(nextArena.terrain[2][2],expected);
			assert.equal(nextArena.changed[2][2],changed_expect);
		};

	});

	QUnit.test("Test-RandomShuffle",function( assert ){//Test function RandomShuffle
		var testArena = new Arena();
		RandomShuffle(testArena);
		for (var i = GLOBAL_CONST.HEIGHT - 1; i >= 0; i--) {//Test whether the value of arena.changed is correct
			for (var j = 0; j < GLOBAL_CONST.WIDTH -1; j++) {
				assert.equal(testArena.changed[i][j],true);
			};
		};
	});

</script>
</head>
<body>
<div id="qunit"></div>
<div id="qunit-fixture">1234567</div>
</body>
</html>